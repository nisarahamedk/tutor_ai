---
task_id: 1
title: "Define AG-UI Event Contracts for Rich Components"
epic: "EPIC-003"
status: "pending"
priority: "high"
estimated_hours: 8
dependencies: ["EPIC-002/1"] # Depends on AI AG-UI event contracts from EPIC-002
parallel_work: ["EPIC-003_TASK_2", "EPIC-003_TASK_4"]
blocking_dependencies: ["EPIC-002/1"]
contract_dependencies: ["AI AG-UI event contracts from EPIC-002/1"] # Builds upon these
phase: "core"
---

# Task Overview
This task is crucial for enabling advanced interactivity in the chat interface. It involves specifying the AG-UI event structures that the backend/AI will use to instruct the frontend to render various rich interactive components (e.g., multiple-choice questions, sliders, interactive cards, code evaluators). It also includes defining the AG-UI events the frontend will send back to the backend as users interact with these components (e.g., submitting an MCQ answer, changing a slider value).

## Business Context
Rich components transform the chat from a simple text exchange into an engaging, interactive learning environment. Clear contracts for these components are essential for decoupling frontend component development from backend AI logic that decides when and how to use them. This allows for parallel work and a more robust system.

## Acceptance Criteria
- [ ] AG-UI event contracts for instructing the frontend to display rich components are defined and documented for at least 3-4 key component types (e.g., MultipleChoiceQuestion, Slider, InfoCard, SkillSelectorButton).
  - [ ] Each contract specifies `component_type` identifier.
  - [ ] Each contract includes a `config` object specific to the component (e.g., for MCQ: `question_text`, `options: [{id, text}]`, `prompt_id`).
  - [ ] Each component rendering event includes a unique `interaction_id` generated by the backend, which the frontend will return with user interaction data.
- [ ] AG-UI event contracts for user interactions with these rich components (FE -> BE) are defined and documented.
  - [ ] Each contract includes the original `interaction_id`.
  - [ ] Payload includes user-submitted data (e.g., for MCQ: `selected_option_id`).
- [ ] Documentation for these contracts is stored in a shared, accessible location (e.g., `docs/agui_contracts/rich_components.md`).
- [ ] Contracts are reviewed and signed off by relevant frontend, backend, and AI development team members.

## Service Layer TDD Approach
### Test Strategy
- Contract validation through clarity, completeness, and review by teams that will implement them.
- These contracts form the basis for mock data generation for both frontend and backend testing of component interactions.

### Key Test Scenarios (for contract validation)
- **Rendering:** Can a frontend developer use the "render component X" event contract to understand all necessary data to display and configure component X? Is the `interaction_id` usage clear?
- **Interaction:** Can a backend developer use the "user interacted with component X" event contract to understand what data to expect from the frontend?
- **Extensibility:** Can new configuration options be added to a component's contract without breaking existing ones (e.g., by making new options optional)?
- **Clarity:** Are component types and configuration parameters clearly named and their data types specified?

## Technical Specifications
### Service Interface Design (AG-UI Events)

**Example: Render Multiple Choice Question (BE -> FE)**
- Event Name: `ui:render_rich_component`
- Payload:
  ```json
  {
    "interaction_id": "uuid_generated_by_backend",
    "component_type": "MultipleChoiceQuestion",
    "config": {
      "question_text": "What is the capital of France?",
      "options": [
        { "id": "opt_1", "text": "Berlin" },
        { "id": "opt_2", "text": "Paris" },
        { "id": "opt_3", "text": "London" }
      ]
    }
  }
  ```

**Example: User Submits MCQ Answer (FE -> BE)**
- Event Name: `ui:component_interaction`
- Payload:
  ```json
  {
    "interaction_id": "same_uuid_as_above", // From the render event
    "component_type": "MultipleChoiceQuestion", // For context
    "user_input": {
      "selected_option_id": "opt_2"
    }
  }
  ```

**Other Potential Components & Configs:**
- **Slider:** `component_type: "SliderInput"`, `config: { "label": "Rate your understanding (1-5)", "min": 1, "max": 5, "step": 1, "default_value": 3 }`
  - Interaction: `user_input: { "value": 4 }`
- **InfoCard:** `component_type: "InfoCard"`, `config: { "title": "Key Concept", "text_content": "...", "image_url": "..." }`
  - Interaction: May not have direct input, or could have "Dismiss", "Learn More" buttons.
- **SkillSelectorButton:** `component_type: "SkillSelectorButton"`, `config: { "label": "Select a skill to practice", "skills": [{"id": "skill_1", "name": "Algebra"}, {"id": "skill_2", "name": "Calculus"}]}`
  - Interaction: `user_input: { "selected_skill_id": "skill_1" }`

### Implementation Guidance
- Document contracts in Markdown with clear JSON schema examples for payloads.
- Ensure all component rendering events from BE include a unique `interaction_id`.
- Ensure all component interaction events from FE include this same `interaction_id` to correlate responses.
- Standardize event names (e.g., `ui:render_rich_component`, `ui:component_interaction`) if possible, relying on `component_type` and `interaction_id` for specifics.
- Consider common fields for all component configs (e.g., `title`, `prompt_text`).

### Dependencies and Prerequisites
- **Blocking Dependencies**: `EPIC-002/1` (AI Agent Interaction Contract & AG-UI Events), as rich components are often presented based on AI decisions and initial AI AG-UI events might be precursors.
- **Contract Dependencies**: Builds upon the general AG-UI communication patterns established in previous epics.
- **Parallel Work Opportunities**: Enables `EPIC-003_TASK_2` (FE Rich Component Library Dev), `EPIC-003_TASK_4` (AI Agent Logic for Rich Components). Frontend can start building components based on these contracts using mock data. Backend can start designing AI logic to emit these events.
- **Mock Requirements**: These contracts are key for creating mock AG-UI events for testing both frontend rendering and backend processing of interactions.
- **Integration Points**: These contracts are the interface between the AI/Backend deciding to show a component and the Frontend rendering it, and then between the Frontend capturing user input and the Backend processing that input.

## Definition of Done
- [ ] AG-UI event contracts for rendering at least 3-4 key rich components are defined, documented, and reviewed.
- [ ] AG-UI event contracts for user interactions with these components are defined, documented, and reviewed.
- [ ] `interaction_id` usage for correlating requests and responses is clearly specified.
- [ ] All contracts are approved by FE, BE, and AI team representatives.
- [ ] Location of contract documents is communicated.

## Technical Notes
- Strive for a balance between generic event structures (e.g., one event to render any component) and specific, clear configs. A common approach is a single "render" event type with a payload that specifies the `component_type` and its unique `config` object.
- Versioning of these component contracts should be considered as new features are added to components.
